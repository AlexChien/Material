<% javascript_tag do %>
   <%if @error_message%>
       alert("<%=@error_message%>");
   <%else%>
       $("#quantity_"+<%=@olir.id%>).attr("value","<%=@olir.apply_adjust%>");
   <%end%>
<% end %>

<%form_for @olir,:url=>{:action=>"update_status"},:html=>{:method=>:put} do |f|%>
<div class="tab">
<table cellspacing="1" cellpadding="0" border="0" width="786">
    <tbody>
        <tr>
            <td colspan="11" id="tab_tit">
                物料明细（<%=@olir.show_status%>）
                <%if @olir.status == 3 || @olir.status == 4%>
                   <a href="/order_line_item_raws/<%=@olir.id%>/print"><img src="/images/icons/printer.png" /></a>
                <%end%>
            </td>
        </tr>
        <tr>
            <td class="f_tab">sku</td>
            <td class="f_tab">物料图片</td>
            <td class="f_tab">物料名称</td>
            <td class="f_tab">所属区</td>
            <td class="f_tab">销售姓名</td>
            <td class="f_tab">物料价格</td>
            <td class="f_tab">预定数量</td>
            <td class="f_tab">小计</td>
            <td class="f_tab">调整申请数量</td>
            <td class="f_tab">申请总数</td>
            <td class="f_tab">申请总计</td>
        </tr>

        <tr>
            <td><%=@olir.material.sku%></td>
            <td><%=image_tag (@olir.material.uploaded_data.url),:onload=>"DrawImage(this,100,75)"%></td>
            <td><%=@olir.material.name%></td>
            <td><%=@olir.region.name%></td>
            <td><%=@olir.salesrep.name%></td>
            <td><%=@olir.unit_price%></td>
            <td><%=@olir.quantity%></td>
            <td>￥<%=@olir.subtotal%></td>
            <td>
            <%if @olir.status == 1%>
                <input type="text" value="<%=@olir.apply_adjust%>" size="3" id="quantity_<%=@olir.id%>">
                <%= link_to_remote '<img src="/images/icons/tick.png" />',
                :url => {:controller => :order_line_item_raws, :action => :apply_update, :id => @olir.id},
                :with => "'&quantity='+$('#quantity_#{@olir.id}').val()",
                :method => :put,
                :update => "order_list"%>
            <%else%>
                <%=@olir.apply_adjust%>
            <%end%>
            </td>
            <td><%=@olir.apply_quantity%></td>
            <td>￥<%=@olir.apply_subtotal%></td>
        </tr>
        <tr>
            <td colspan="11" id="tab_tit02"></td>
        </tr>
    </tbody>
</table>
</div>

<div class="tab">
    <table cellspacing="1" cellpadding="0" border="0" width="786" class="tab01">
        <tbody>
            <tr>
                <td id="tab_tit" colspan="4">详细送货地址</td>
            </tr>
            <tr>
                <td><%= label_tag :address, "<em>*</em>请填写详细送货地址" %></td>
                <td class="td_left">
                    <%if @olir.status == 1%>
                        <%= f.text_field :address,:value=>"#{@olir.address.blank? ? @olir.salesrep.address : @olir.address}"%>
                    <%else%>
                        <%= f.text_field :address,:value=>"#{@olir.address.blank? ? @olir.salesrep.address : @olir.address}",:disabled=>"disabled"%>
                    <%end%>
                </td>
            </tr>
            <tr>
                <td><%= label_tag :memo, "<em>*</em>请填写备注" %></td>
                <td class="td_left">
                    <%if @olir.status == 1%>
                        <%= f.text_area :memo,:value=>"#{@olir.memo.blank? ? @olir.salesrep.memo : @olir.memo}" %>
                    <%else%>
                        <%= f.text_area :memo,:value=>"#{@olir.memo.blank? ? @olir.salesrep.memo : @olir.memo}",:disabled=>"disabled" %>
                    <%end%>
                </td>
            </tr>
            <tr><td id="tab_tit" colspan="4"></td>
            </tr>
        </tbody>
    </table>
    <br/>
    <%if current_user.has_role?("rc")%>
        <%if @olir.status == 1%>
        <div class="tab_btn">
            <%= f.submit "提交申请",:class=>"button_btn",:confirm=>"提交后将不能修改申请！您确认此次提交吗？" %>
        </div>
        <%end%>

        <%if @olir.status == 4%>
        <div class="tab_btn">
            <%= f.submit "确认收货",:class=>"button_btn",:confirm=>"确认后将完成整个申请！您确认此次收货吗？" %>
        </div>
        <%end%>
    <%end%>

    <%if current_user.has_role?("rm")%>
        <%if @olir.status == 2%>
        <div class="tab_btn">
            <%= f.submit "提交审批",:class=>"button_btn",:confirm=>"提交后将不能修改审批！您确认此次审批吗？" %>
        </div>
        <%end%>
    <%end%>

    <%if current_user.has_role?("wa")%>
        <%if @olir.status == 3%>
        <div class="tab_btn">
            <%= f.submit "我要发货",:class=>"button_btn",:confirm=>"本次将发给销售#{@olir.salesrep.name}#{@olir.apply_quantity}个#{@olir.material.name}！您确认此次发货吗？" %>
        </div>
        <%end%>
    <%end%>
</div>
<%end%>